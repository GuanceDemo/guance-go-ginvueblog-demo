var G=Object.defineProperty;var E=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var $=(u,i,l)=>i in u?G(u,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[i]=l,C=(u,i)=>{for(var l in i||(i={}))L.call(i,l)&&$(u,l,i[l]);if(E)for(var l of E(i))K.call(i,l)&&$(u,l,i[l]);return u};var q=(u,i,l)=>new Promise((f,p)=>{var k=d=>{try{c(l.next(d))}catch(y){p(y)}},N=d=>{try{c(l.throw(d))}catch(y){p(y)}},c=d=>d.done?f(d.value):Promise.resolve(d.value).then(k,N);c((l=l.apply(u,i)).next())});import{r as U,k as _,p as j,o as V,c as Z,w as r,a as n,b as z,u as a,N as h,j as H,Z as J,ab as Q,aa as W,q as X,d as Y,v as m,C as ee,x as ae,y as S,t as te}from"./index-f53dfd2d.js";import{_ as le}from"./CommonPage-328ed173.js";import{_ as ne}from"./QueryBarItem-a7adc33b.js";import{_ as B}from"./CrudModal-8441a1a6.js";import{_ as ie}from"./CrudTable-e7ebf5b4.js";import{u as re}from"./useCRUD-6648f9c7.js";import{N as oe}from"./GradientText-7d3e1909.js";import{N as b}from"./Input-d1b207b8.js";import{N as D,a as g}from"./FormItem-9890d329.js";import{N as se,a as ue}from"./RadioGroup-373382a0.js";import{b as de}from"./Space-fc8792cb.js";import{N as me}from"./Switch-5cbaa6a9.js";import{N as fe}from"./Popconfirm-7d90b5a9.js";import"./AppPage-64321f57.js";import"./Checkbox-23248bff.js";import"./Forward-fc22679e.js";import"./get-slot-1efb97e5.js";const pe=Y("span",{class:"i-material-symbols:add mr-5 text-18"},null,-1),Ve=Object.assign({name:"接口管理"},{__name:"index",setup(u){const i=U(null),l=U({}),{modalVisible:f,modalAction:p,modalTitle:k,modalLoading:N,handleAdd:c,handleDelete:d,handleEdit:y,handleSave:T,modalForm:s,modalFormRef:R}=re({name:"接口",doCreate:_.saveOrUpdateResource,doDelete:_.deleteResource,doUpdate:_.saveOrUpdateResource,refresh:()=>{var e;return(e=i.value)==null?void 0:e.handleSearch()}});j(()=>{var e;(e=i.value)==null||e.handleSearch()});const F=["GET","POST","DELETE","PUT"];function x(e){switch(e){case"GET":return"info";case"POST":return"success";case"PUT":return"warning";case"DELETE":return"error";default:return"info"}}const M=[{title:"资源名称",key:"name",width:80,ellipsis:{tooltip:!0}},{title:"资源路径",key:"url",width:100,ellipsis:{tooltip:!0}},{title:"请求方式",key:"request_method",width:50,align:"center",render(e){return e.children?"":m(ee,{type:x(e.request_method)},{default:()=>e.request_method})}},{title:"匿名访问",key:"is_hidden",width:50,align:"center",fixed:"left",render(e){return e.children?"":m(me,{size:"small",rubberBand:!1,value:e.is_anonymous,loading:!!e.publishing,checkedValue:1,uncheckedValue:0,onUpdateValue:()=>P(e)})}},{title:"创建日期",key:"created_at",width:60,render(e){return m("span",ae(e.created_at))}},{title:"操作",key:"actions",width:115,align:"center",fixed:"right",render(e){return[m(h,{size:"tiny",quaternary:!0,type:"primary",style:`display: ${e.children?"":"none"};`,onClick:()=>{c(),s.value.parent_id=e.id}},{default:()=>"新增",icon:S("material-symbols:add",{size:16})}),m(h,{size:"tiny",quaternary:!0,type:"info",onClick:()=>e.children?I(e):y(e)},{default:()=>"编辑",icon:S("material-symbols:edit-outline",{size:16})}),m(fe,{onPositiveClick:()=>{d(e.id,!1)}},{trigger:()=>m(h,{size:"tiny",quaternary:!0,type:"error"},{default:()=>"删除",icon:S("material-symbols:delete-outline",{size:16})}),default:()=>m("div",{},"确定删除该接口吗?")})]}}];function P(e){return q(this,null,function*(){e.id&&(e.publishing=!0,e.is_anonymous=e.is_anonymous===0?1:0,yield _.updateResourceAnonymous(e),e.publishing=!1,$message==null||$message.success(e.is_anonymous?"已允许匿名访问":"已禁止匿名访问"))})}const v=U(!1);function A(){p.value="add",s.value={},v.value=!0}function I(e){p.value="edit",s.value=C({},e),v.value=!0}function O(){return q(this,null,function*(){T(),v.value=!1})}return(e,o)=>(V(),Z(le,{title:"接口管理"},{action:r(()=>[n(a(h),{type:"primary",onClick:A},{default:r(()=>[pe,z(" 新增模块 ")]),_:1})]),default:r(()=>[n(ie,{ref_key:"$table",ref:i,"query-items":l.value,"onUpdate:queryItems":o[1]||(o[1]=t=>l.value=t),"is-pagination":!1,columns:M,"get-data":a(_).getResources,"single-line":!0},{queryBar:r(()=>[n(ne,{label:"资源名","label-width":50},{default:r(()=>{var t;return[n(a(b),{value:l.value.keyword,"onUpdate:value":o[0]||(o[0]=w=>l.value.keyword=w),clearable:"",type:"text",placeholder:"请输入资源名",onKeydown:H((t=i.value)==null?void 0:t.handleSearch,["enter"])},null,8,["value","onKeydown"])]}),_:1})]),_:1},8,["query-items","get-data"]),n(B,{visible:a(f),"onUpdate:visible":o[5]||(o[5]=t=>X(f)?f.value=t:null),title:a(k),loading:a(N),onSave:a(T)},{default:r(()=>[n(a(D),{ref_key:"modalFormRef",ref:R,"label-placement":"left","label-align":"left","label-width":80,model:a(s)},{default:r(()=>[n(a(g),{label:"资源名",path:"name"},{default:r(()=>[n(a(b),{value:a(s).name,"onUpdate:value":o[2]||(o[2]=t=>a(s).name=t),placeholder:"请输入资源名"},null,8,["value"])]),_:1}),n(a(g),{label:"资源路径",path:"url"},{default:r(()=>[n(a(b),{value:a(s).url,"onUpdate:value":o[3]||(o[3]=t=>a(s).url=t),placeholder:"请输入资源路径"},null,8,["value"])]),_:1}),n(a(g),{label:"请求方式",path:"request_method"},{default:r(()=>[n(a(se),{value:a(s).request_method,"onUpdate:value":o[4]||(o[4]=t=>a(s).request_method=t),name:"radiogroup"},{default:r(()=>[n(a(de),null,{default:r(()=>[(V(),J(W,null,Q(F,t=>n(a(ue),{key:t,value:t},{default:r(()=>[n(a(oe),{type:x(t)},{default:r(()=>[z(te(t),1)]),_:2},1032,["type"])]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading","onSave"]),n(B,{visible:v.value,"onUpdate:visible":o[7]||(o[7]=t=>v.value=t),title:`${a(p)==="add"?"新增":"编辑"}模块`,loading:a(f),onSave:O},{default:r(()=>[n(a(D),{ref_key:"modalFormRef",ref:R,"label-placement":"left","label-align":"left","label-width":80,model:a(s)},{default:r(()=>[n(a(g),{label:"模块名",path:"name"},{default:r(()=>[n(a(b),{value:a(s).name,"onUpdate:value":o[6]||(o[6]=t=>a(s).name=t),placeholder:"请输入模块名"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading"])]),_:1}))}});export{Ve as default};
