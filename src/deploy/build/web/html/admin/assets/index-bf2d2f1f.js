var U=(u,C,d)=>new Promise((_,b)=>{var c=r=>{try{m(d.next(r))}catch(a){b(a)}},p=r=>{try{m(d.throw(r))}catch(a){b(a)}},m=r=>r.done?_(r.value):Promise.resolve(r.value).then(c,p);m((d=d.apply(u,C)).next())});import{D as te,E as le,F as ne,G as se,H as oe,I as E,J as ue,K as ie,L as re,r as f,M as Q,O as de,P as ce,Q as $,R as pe,v as I,S as me,T as X,C as Y,N as W,U as ve,V as P,W as ge,g as fe,h as he,f as ye,X as be,Y as M,A as _e,o as z,c as G,w as i,d as we,a as n,u as s,Z as H,$ as L,b as A,k as D}from"./index-f53dfd2d.js";import{W as Ce}from"./style-fe30423b.js";import{_ as Te}from"./CommonPage-328ed173.js";import{_ as Re}from"./CrudModal-8441a1a6.js";import{_ as Se}from"./UploadOne-0ce475ec.js";import{a as Ve}from"./data-b2a19723.js";import{N as Ie,a as V}from"./FormItem-9890d329.js";import{u as xe,N as K}from"./Input-d1b207b8.js";import{s as Oe,a as Ne,b as Z,N as j}from"./Space-fc8792cb.js";import{A as Ue}from"./Add-8e2e4207.js";import{N as ke,a as J}from"./RadioGroup-373382a0.js";import{N as Be}from"./Switch-5cbaa6a9.js";import"./AppPage-64321f57.js";import"./Upload-33df3990.js";import"./Image-3871d8d9.js";import"./utils-faaa8f65.js";import"./get-slot-1efb97e5.js";const Fe=te({name:"DynamicTags",common:le,peers:{Input:ne,Button:se,Tag:oe,Space:Oe},self(){return{inputWidth:"64px"}}}),Ae=Fe,$e=E("dynamic-tags",[E("input",{minWidth:"var(--n-input-width)"})]),ze=Object.assign(Object.assign(Object.assign({},Q.props),me),{size:{type:String,default:"medium"},closable:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[]},value:Array,inputStyle:[String,Object],inputProps:Object,max:Number,tagStyle:[String,Object],renderTag:Function,onCreate:{type:Function,default:u=>u},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),De=ue({name:"DynamicTags",props:ze,setup(u){const{mergedClsPrefixRef:C,inlineThemeDisabled:d}=ie(u),{localeRef:_}=xe("DynamicTags"),b=re(u),{mergedDisabledRef:c}=b,p=f(""),m=f(!1),r=f(!0),a=f(null),v=Q("DynamicTags","-dynamic-tags",$e,Ae,u,C),w=f(u.defaultValue),S=de(u,"value"),T=ce(S,w),k=$(()=>_.value.add),B=$(()=>Ne(u.size)),x=$(()=>c.value||!!u.max&&T.value.length>=u.max);function O(l){const{onChange:g,"onUpdate:value":F,onUpdateValue:q}=u,{nTriggerFormInput:ee,nTriggerFormChange:ae}=b;g&&P(g,l),q&&P(q,l),F&&P(F,l),w.value=l,ee(),ae()}function N(l){const g=T.value.slice(0);g.splice(l,1),O(g)}function o(l){switch(l.key){case"Enter":e()}}function e(l){const g=l!=null?l:p.value;if(g){const F=T.value.slice(0);F.push(u.onCreate(g)),O(F)}m.value=!1,r.value=!0,p.value=""}function t(){e()}function R(){m.value=!0,X(()=>{var l;(l=a.value)===null||l===void 0||l.focus(),r.value=!1})}const h=$(()=>{const{self:{inputWidth:l}}=v.value;return{"--n-input-width":l}}),y=d?pe("dynamic-tags",void 0,h,u):void 0;return{mergedClsPrefix:C,inputInstRef:a,localizedAdd:k,inputSize:B,inputValue:p,showInput:m,inputForceFocused:r,mergedValue:T,mergedDisabled:c,triggerDisabled:x,handleInputKeyUp:o,handleAddClick:R,handleInputBlur:t,handleCloseClick:N,handleInputConfirm:e,mergedTheme:v,cssVars:d?void 0:h,themeClass:y==null?void 0:y.themeClass,onRender:y==null?void 0:y.onRender}},render(){const{mergedTheme:u,cssVars:C,mergedClsPrefix:d,onRender:_,renderTag:b}=this;return _==null||_(),I(Z,{class:[`${d}-dynamic-tags`,this.themeClass],size:"small",style:C,theme:u.peers.Space,themeOverrides:u.peerOverrides.Space,itemStyle:"display: flex;"},{default:()=>{const{mergedTheme:c,tagStyle:p,type:m,round:r,size:a,color:v,closable:w,mergedDisabled:S,showInput:T,inputValue:k,inputStyle:B,inputSize:x,inputForceFocused:O,triggerDisabled:N,handleInputKeyUp:o,handleInputBlur:e,handleAddClick:t,handleCloseClick:R,handleInputConfirm:h,$slots:y}=this;return this.mergedValue.map((l,g)=>b?b(l,g):I(Y,{key:g,theme:c.peers.Tag,themeOverrides:c.peerOverrides.Tag,style:p,type:m,round:r,size:a,color:v,closable:w,disabled:S,onClose:()=>{R(g)}},{default:()=>typeof l=="string"?l:l.label})).concat(T?y.input?y.input({submit:h,deactivate:e}):I(K,Object.assign({placeholder:"",size:x,style:B,autosize:!0},this.inputProps,{ref:"inputInstRef",value:k,onUpdateValue:l=>{this.inputValue=l},theme:c.peers.Input,themeOverrides:c.peerOverrides.Input,onKeyup:o,onBlur:e,internalForceFocus:O})):y.trigger?y.trigger({activate:t,disabled:N}):I(W,{dashed:!0,disabled:N,theme:c.peers.Button,themeOverrides:c.peerOverrides.Button,size:x,onClick:t},{icon:()=>I(ve,{clsPrefix:d},{default:()=>I(Ue,null)})}))}})}});const Pe={class:"mb-15 flex items-center bg-white"},Le={key:0,class:"i-line-md:uploading-loop mr-5 text-18"},je={key:0,class:"i-line-md:confirm-circle mr-5 text-18"},We=Object.assign({name:"发布文章"},{__name:"index",setup(u){const[C,d]=[fe(),he()],[_,b]=[ye(),be()],c=f([]),p=f([]);let m=[];M(d,()=>U(this,null,function*(){return _.reloadPage()})),_e(()=>U(this,null,function*(){D.getCategoryOption().then(o=>c.value=o.data.map(e=>({value:e.label,label:e.label}))),D.getTagOption().then(o=>{p.value=o.data.map(e=>({value:e.label,label:e.label})),m=p.value}),yield T(),yield X(()=>{})}));const r=f(null),a=f({status:1,is_top:0}),v=f(!1),w=f(!1),S=f(null);M(()=>a.value.tag_names,o=>{p.value=m.filter(e=>!o.includes(e.label))},{deep:!0});function T(){return U(this,null,function*(){var e,t,R;const o=d.params.id;if(!o){a.value={status:1,is_top:0,title:""};return}(e=window.$loadingBar)==null||e.start(),$message.loading("加载中...");try{const h=yield D.getArticleById(o);a.value=h.data,(t=window.$loadingBar)==null||t.finish(),$message==null||$message.success("加载成功")}catch(h){(R=window.$loadingBar)==null||R.error(),$message==null||$message.error("加载失败")}})}function k(){$message.info("保存草稿开发中")}function B(){var o,e;if(!a.value.title||!((o=a.value.title)!=null&&o.trim())){a.value.title=(e=a.value.title)==null?void 0:e.trim(),$message.info("请输入标题");return}w.value=!0}function x(){return U(this,null,function*(){var o;(o=r.value)==null||o.validate(e=>U(this,null,function*(){if(!e){v.value=!0,$message.loading("正在保存...");try{yield D.saveOrUpdateArticle(a.value),w.value=!1,$message.success("操作成功!"),b.removeTag(d.path),yield C.replace({path:"/article/list",query:{needRefresh:!0}})}catch(t){}finally{v.value=!1}}}))})}const O={category_name:{required:!0,message:"请选择文章分类",trigger:["blur","change"]},tag_names:{required:!0,message:"请选择文章标签"}};function N(o,e){return I(Y,{type:"info",disabled:e>3,closable:!0,onClose:()=>a.value.tag_names.splice(e,1)},{default:()=>o})}return(o,e)=>(z(),G(Te,{"show-header":!1,"show-footer":"",title:"写文章"},{default:i(()=>[we("div",Pe,[n(s(K),{value:a.value.title,"onUpdate:value":e[0]||(e[0]=t=>a.value.title=t),type:"text",class:"mr-20 flex-1 py-5 text-18 font-bold color-primary",placeholder:"输入文章标题..."},null,8,["value"]),n(s(W),{ghost:"",type:"error",class:"mr-10",loading:v.value,onClick:k},{default:i(()=>[v.value?L("",!0):(z(),H("span",Le)),A(" 保存草稿 ")]),_:1},8,["loading"]),n(s(W),{type:"error",loading:v.value,onClick:B},{default:i(()=>[v.value?L("",!0):(z(),H("span",je)),A(" 发布文章 ")]),_:1},8,["loading"])]),n(s(Ce),{modelValue:a.value.content,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.content=t),style:{height:"calc(100vh - 305px)"}},null,8,["modelValue"]),n(Re,{visible:w.value,"onUpdate:visible":e[10]||(e[10]=t=>w.value=t),title:"发布文章",loading:v.value,"show-footer":"",onSave:x},{default:i(()=>[n(s(Ie),{ref_key:"formRef",ref:r,"label-placement":"left","label-align":"left","label-width":100,model:a.value,rules:O},{default:i(()=>[n(s(V),{label:"文章分类",path:"category_name"},{default:i(()=>[n(s(j),{value:a.value.category_name,"onUpdate:value":e[2]||(e[2]=t=>a.value.category_name=t),style:{width:"50%"},clearable:"",filterable:"",tag:"",placeholder:"关键字搜索，enter 添加",options:c.value},null,8,["value","options"])]),_:1}),n(s(V),{label:"文章标签",path:"tag_names"},{default:i(()=>[n(s(De),{value:a.value.tag_names,"onUpdate:value":e[4]||(e[4]=t=>a.value.tag_names=t),"render-tag":N,max:3},{input:i(({submit:t,deactivate:R})=>[n(s(j),{value:S.value,"onUpdate:value":[e[3]||(e[3]=h=>S.value=h),h=>{t(h),S.value=null}],size:"small",filterable:"",tag:"",clearable:"",options:p.value,placeholder:"标签名称",onBlur:R},{action:i(()=>[A(" 输入标签名搜索，enter 添加自定义标签 ")]),_:2},1032,["value","options","onUpdate:value","onBlur"])]),_:1},8,["value"])]),_:1}),n(s(V),{label:"文章类型",path:"type"},{default:i(()=>[n(s(j),{value:a.value.type,"onUpdate:value":e[5]||(e[5]=t=>a.value.type=t),style:{width:"50%"},placeholder:"请选择文章分类",options:s(Ve)},null,8,["value","options"])]),_:1}),a.value.type===2||a.value.type===3?(z(),G(s(V),{key:0,label:"原文地址",path:"original_url"},{default:i(()=>[n(s(K),{value:a.value.original_url,"onUpdate:value":e[6]||(e[6]=t=>a.value.original_url=t),type:"text",placeholder:"请填写原文连接"},null,8,["value"])]),_:1})):L("",!0),n(s(V),{label:"文章缩略图",path:"img"},{default:i(()=>[n(Se,{preview:a.value.img,"onUpdate:preview":e[7]||(e[7]=t=>a.value.img=t),width:220},null,8,["preview"])]),_:1}),n(s(V),{label:"置顶",path:"is_top"},{default:i(()=>[n(s(Be),{value:a.value.is_top,"onUpdate:value":e[8]||(e[8]=t=>a.value.is_top=t),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),n(s(V),{label:"发布形式",path:"status"},{default:i(()=>[n(s(ke),{value:a.value.status,"onUpdate:value":e[9]||(e[9]=t=>a.value.status=t),name:"radiogroup"},{default:i(()=>[n(s(Z),null,{default:i(()=>[n(s(J),{value:1},{default:i(()=>[A(" 公开 ")]),_:1}),n(s(J),{value:2},{default:i(()=>[A(" 私密 ")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","loading"])]),_:1}))}}),ua=ge(We,[["__scopeId","data-v-6c80688c"]]);export{ua as default};
