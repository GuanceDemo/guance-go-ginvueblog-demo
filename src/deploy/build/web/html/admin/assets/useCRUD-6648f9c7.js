var N=Object.defineProperty;var A=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var $=(n,a,e)=>a in n?N(n,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[a]=e,d=(n,a)=>{for(var e in a||(a={}))O.call(a,e)&&$(n,e,a[e]);if(A)for(var e of A(a))R.call(a,e)&&$(n,e,a[e]);return n};var m=(n,a,e)=>new Promise((w,v)=>{var f=l=>{try{t(e.next(l))}catch(i){v(i)}},s=l=>{try{t(e.throw(l))}catch(i){v(i)}},t=l=>l.done?w(l.value):Promise.resolve(l.value).then(f,s);t((e=e.apply(n,a)).next())});import{r,Q as T}from"./index-f53dfd2d.js";const V={view:"查看",edit:"编辑",add:"新增"};function F({name:n,initForm:a={},doCreate:e,doDelete:w,doUpdate:v,refresh:f}){const s=r(!1),t=r(""),l=r(!1),i=T(()=>V[t.value]+n),c=r(d({},a)),p=r(null);function b(){t.value="add",s.value=!0,c.value=d({},a)}function D(o){t.value="edit",s.value=!0,c.value=d({},o)}function S(o){t.value="view",s.value=!0,c.value=d({},o)}function C(){var o;if(!["edit","add"].includes(t.value)){s.value=!1;return}(o=p.value)==null||o.validate(g=>m(this,null,function*(){if(!g){const u={add:{api:()=>e(c.value),cb:()=>window.$message.success("新增成功")},edit:{api:()=>v(c.value),cb:()=>window.$message.success("编辑成功")}}[t.value];try{l.value=!0;const h=yield u.api();u.cb(),l.value=s.value=!1,h&&f(h)}catch(h){l.value=!1}}}))}function I(o,g=!0){return m(this,null,function*(){if(!o||Array.isArray(o)&&!o.length){window.$message.info("请选择要删除的数据");return}const y=()=>m(this,null,function*(){try{l.value=!0;const u=yield w(JSON.stringify(o));(u==null?void 0:u.code)===0&&window.$message.success("删除成功"),l.value=!1,f(u)}catch(u){l.value=!1}});g?window.$dialog.confirm({content:"确定删除？",confirm:()=>y()}):y()})}return{modalVisible:s,modalAction:t,modalTitle:i,modalLoading:l,handleAdd:b,handleDelete:I,handleEdit:D,handleView:S,handleSave:C,modalForm:c,modalFormRef:p}}export{F as u};
