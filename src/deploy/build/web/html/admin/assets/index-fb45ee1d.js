var x=(b,a,r)=>new Promise((d,m)=>{var g=e=>{try{u(r.next(e))}catch(t){m(t)}},p=e=>{try{u(r.throw(e))}catch(t){m(t)}},u=e=>e.done?d(e.value):Promise.resolve(e.value).then(g,p);u((r=r.apply(b,a)).next())});import{p as C,r as y,k as h,o as z,c as I,w as o,a as s,b as _,u as l,N as c,j as P,d as N,v as n,B,x as U,y as v,C as q}from"./index-f53dfd2d.js";import{_ as T}from"./CommonPage-328ed173.js";import{_ as D}from"./QueryBarItem-a7adc33b.js";import{_ as M}from"./CrudTable-e7ebf5b4.js";import{u as S}from"./useCRUD-6648f9c7.js";import{N as w,a as R}from"./Tabs-435e8678.js";import{N as V}from"./Input-d1b207b8.js";import{N as j}from"./Image-3871d8d9.js";import{N as K}from"./Popconfirm-7d90b5a9.js";import"./AppPage-64321f57.js";import"./Space-fc8792cb.js";import"./RadioGroup-373382a0.js";import"./get-slot-1efb97e5.js";import"./Checkbox-23248bff.js";import"./Forward-fc22679e.js";import"./Add-8e2e4207.js";import"./utils-faaa8f65.js";const O=N("span",{class:"i-material-symbols:recycling-rounded mr-5 text-18"},null,-1),A=N("span",{class:"i-ic:outline-approval mr-5 text-18"},null,-1),ne=Object.assign({name:"留言管理"},{__name:"index",setup(b){C(()=>{u("all")});const a=y(null),r=y({}),d=y({}),{handleDelete:m}=S({name:"留言",doDelete:h.deleteMessages,refresh:()=>{var e;return(e=a.value)==null?void 0:e.handleSearch()}}),g=[{type:"selection",width:15,fixed:"left"},{title:"头像",key:"avatar",width:50,align:"center",render(e){return n(j,{height:50,imgProps:{style:{"border-radius":"3px"}},src:B(e.avatar),"fallback-src":"http://dummyimage.com/400x400","show-toolbar-tooltip":!0})}},{title:"留言人",key:"nickname",width:60,align:"center",ellipsis:{tooltip:!0}},{title:"留言内容",key:"content",width:120,align:"center"},{title:"IP 地址",key:"ip_address",width:70,align:"center",ellipsis:{tooltip:!0}},{title:"IP 来源",key:"ip_source",width:70,align:"center",ellipsis:{tooltip:!0},render(e){return n("span",e.ip_source||"未知")}},{title:"留言时间",key:"created_at",align:"center",width:80,render(e){return n(c,{size:"small",type:"text",ghost:!0},{default:()=>U(e.created_at),icon:v("mdi:update",{size:18})})}},{title:"状态",key:"is_review",width:50,align:"center",render(e){return n(q,{type:e.is_review?"success":"error"},{default:()=>e.is_review?"通过":"审核中"})}},{title:"操作",key:"actions",width:100,align:"center",fixed:"right",render(e){return[e.is_review?n(c,{size:"small",type:"warning",style:"margin-left: 15px;",onClick:()=>p([e.id],0)},{default:()=>"撤下",icon:v("mi:circle-error",{size:16})}):n(c,{size:"small",type:"success",style:"margin-left: 15px;",onClick:()=>p([e.id],1)},{default:()=>"通过",icon:v("mi:circle-check",{size:16})}),n(K,{onPositiveClick:()=>m([e.id],!1)},{trigger:()=>n(c,{size:"small",type:"error",style:"margin-left: 15px;"},{default:()=>"删除",icon:v("material-symbols:delete-outline",{size:16})}),default:()=>n("div",{},"确定删除该条留言吗?")})]}}];function p(e,t){return x(this,null,function*(){var i;if(!e.length){$message.info("请选择要审核的数据");return}yield h.updateMessageReview({ids:e,is_review:t}),$message==null||$message.success(t?"审核成功":"撤下成功"),(i=a.value)==null||i.handleSearch()})}function u(e){var t;switch(e){case"all":d.value.is_review=null;break;case"has_review":d.value.is_review=1;break;case"not_review":d.value.is_review=0;break}(t=a.value)==null||t.handleSearch()}return(e,t)=>(z(),I(T,{"show-footer":"",title:"留言管理"},{action:o(()=>{var i,f;return[s(l(c),{type:"error",disabled:!((i=a.value)!=null&&i.selections.length),onClick:t[0]||(t[0]=$=>{var k;return l(m)((k=a.value)==null?void 0:k.selections)})},{default:o(()=>[O,_(" 批量删除 ")]),_:1},8,["disabled"]),s(l(c),{type:"success",disabled:!((f=a.value)!=null&&f.selections.length),onClick:t[1]||(t[1]=$=>p(a.value.selections,1))},{default:o(()=>[A,_(" 批量通过 ")]),_:1},8,["disabled"])]}),default:o(()=>[s(l(R),{type:"line",animated:"","onUpdate:value":u},{prefix:o(()=>[_(" 状态 ")]),default:o(()=>[s(l(w),{name:"all",tab:"全部"}),s(l(w),{name:"has_review",tab:"通过"}),s(l(w),{name:"not_review",tab:"审核中"})]),_:1}),s(M,{ref_key:"$table",ref:a,"query-items":r.value,"onUpdate:queryItems":t[4]||(t[4]=i=>r.value=i),"extra-params":d.value,columns:g,"get-data":l(h).getMessages},{queryBar:o(()=>[s(D,{label:"用户","label-width":40,"content-width":180},{default:o(()=>[s(l(V),{value:r.value.nickname,"onUpdate:value":t[2]||(t[2]=i=>r.value.nickname=i),clearable:"",type:"text",placeholder:"请输入用户昵称",onKeydown:t[3]||(t[3]=P(i=>{var f;return(f=a.value)==null?void 0:f.handleSearch()},["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["query-items","extra-params","get-data"])]),_:1}))}});export{ne as default};
