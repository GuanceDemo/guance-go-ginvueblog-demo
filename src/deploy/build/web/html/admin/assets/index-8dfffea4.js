var _=(g,d,i)=>new Promise((t,v)=>{var b=n=>{try{l(i.next(n))}catch(m){v(m)}},f=n=>{try{l(i.throw(n))}catch(m){v(m)}},l=n=>n.done?t(n.value):Promise.resolve(n.value).then(b,f);l((i=i.apply(g,d)).next())});import{_ as R}from"./CommonPage-328ed173.js";import{_ as C}from"./UploadOne-0ce475ec.js";import{e as q,r as c,o as B,c as S,w as r,a,u as s,d as h,N as y,b as k,k as N}from"./index-f53dfd2d.js";import{N as F,a as $}from"./Tabs-435e8678.js";import{N as x,a as p}from"./FormItem-9890d329.js";import{N as w}from"./Input-d1b207b8.js";import"./AppPage-64321f57.js";import"./Upload-33df3990.js";import"./Add-8e2e4207.js";import"./Image-3871d8d9.js";import"./utils-faaa8f65.js";const I={class:"m-30 flex items-center"},T={class:"mr-30 w-200"},M={__name:"index",setup(g){const d=q(),i=c(null),t=c({avatar:d.avatar,nickname:d.nickname,intro:d.intro,website:d.website});function v(){return _(this,null,function*(){var u;(u=i.value)==null||u.validate(e=>_(this,null,function*(){e||(yield N.updateCurrent(t.value),$message.success("更新成功!"),d.setUserInfo(t.value))}))})}const b={nickname:[{required:!0,message:"请输入昵称",trigger:["input","blur","change"]}]},f=c(null),l=c({old_password:"",new_password:"",confirm_password:""});function n(){var u;(u=f.value)==null||u.validate(e=>_(this,null,function*(){e||(yield N.updateCurrentPassword(l),$message.success("修改成功!"))}))}const m={old_password:[{required:!0,message:"请输入旧密码",trigger:["input","blur","change"]}],new_password:[{required:!0,message:"请输入新密码",trigger:["input","blur","change"]}],confirm_password:[{required:!0,message:"请再次输入密码",trigger:["input","blur"]},{validator:U,message:"两次密码输入不一致",trigger:"input"},{validator:P,message:"两次密码输入不一致",trigger:["blur","password-input"]}]};function U(u,e){return!!l.value.new_password&&l.value.new_password.startsWith(e)&&l.value.new_password.length>=e.length}function P(u,e){return e===l.value.new_password}return(u,e)=>(B(),S(R,{"show-header":!1},{default:r(()=>[a(s($),{type:"line",animated:""},{default:r(()=>[a(s(F),{name:"website",tab:"修改信息"},{default:r(()=>[h("div",I,[h("div",T,[a(C,{preview:t.value.avatar,"onUpdate:preview":e[0]||(e[0]=o=>t.value.avatar=o),width:130},null,8,["preview"])]),a(s(x),{ref_key:"infoFormRef",ref:i,"label-placement":"left","label-align":"left","label-width":"100",model:t.value,rules:b,class:"w-400"},{default:r(()=>[a(s(p),{label:"昵称",path:"nickname"},{default:r(()=>[a(s(w),{value:t.value.nickname,"onUpdate:value":e[1]||(e[1]=o=>t.value.nickname=o),type:"text",placeholder:"请填写昵称"},null,8,["value"])]),_:1}),a(s(p),{label:"个人简介",path:"intro"},{default:r(()=>[a(s(w),{value:t.value.intro,"onUpdate:value":e[2]||(e[2]=o=>t.value.intro=o),type:"text",placeholder:"请填写个人简介"},null,8,["value"])]),_:1}),a(s(p),{label:"个人网站",path:"website"},{default:r(()=>[a(s(w),{value:t.value.website,"onUpdate:value":e[3]||(e[3]=o=>t.value.website=o),type:"text",placeholder:"请填写个人网站"},null,8,["value"])]),_:1}),a(s(y),{type:"primary",onClick:v},{default:r(()=>[k(" 修改 ")]),_:1})]),_:1},8,["model"])])]),_:1}),a(s(F),{name:"contact",tab:"修改密码"},{default:r(()=>[a(s(x),{ref_key:"passwordFormRef",ref:f,"label-placement":"left","label-align":"left",model:l.value,"label-width":"100",rules:m,class:"m-30 w-400"},{default:r(()=>[a(s(p),{label:"旧密码",path:"old_password"},{default:r(()=>[a(s(w),{value:l.value.old_password,"onUpdate:value":e[4]||(e[4]=o=>l.value.old_password=o),type:"password","show-password-on":"mousedown",placeholder:"请输入旧密码"},null,8,["value"])]),_:1}),a(s(p),{label:"新密码",path:"new_password"},{default:r(()=>[a(s(w),{value:l.value.new_password,"onUpdate:value":e[5]||(e[5]=o=>l.value.new_password=o),disabled:!l.value.old_password,type:"password","show-password-on":"mousedown",placeholder:"请输入新密码"},null,8,["value","disabled"])]),_:1}),a(s(p),{label:"确认密码",path:"confirm_password"},{default:r(()=>[a(s(w),{value:l.value.confirm_password,"onUpdate:value":e[6]||(e[6]=o=>l.value.confirm_password=o),disabled:!l.value.new_password,type:"password","show-password-on":"mousedown",placeholder:"请再次输入新密码"},null,8,["value","disabled"])]),_:1}),a(s(y),{type:"primary",onClick:n},{default:r(()=>[k(" 修改 ")]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}))}};export{M as default};
