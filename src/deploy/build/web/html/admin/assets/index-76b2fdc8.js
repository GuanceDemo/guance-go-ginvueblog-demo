var S=(N,h,u)=>new Promise((y,g)=>{var $=i=>{try{o(u.next(i))}catch(f){g(f)}},r=i=>{try{o(u.throw(i))}catch(f){g(f)}},o=i=>i.done?y(i.value):Promise.resolve(i.value).then($,r);o((u=u.apply(N,h)).next())});import{h as j,g as P,z as E,r as _,p as F,k as m,A as J,o as K,c as L,w as d,a as s,b as k,u as n,N as c,d as x,j as M,v as p,B as W,C as A,x as G,y as U}from"./index-f53dfd2d.js";import{_ as H}from"./CommonPage-328ed173.js";import{_ as C}from"./QueryBarItem-a7adc33b.js";import{_ as Q}from"./CrudTable-e7ebf5b4.js";import{u as X}from"./useCRUD-6648f9c7.js";import{a as Y,b as B}from"./data-b2a19723.js";import{N as Z}from"./Upload-33df3990.js";import{N as w,a as ee}from"./Tabs-435e8678.js";import{N as te}from"./Input-d1b207b8.js";import{N as T}from"./Space-fc8792cb.js";import{N as ae}from"./Image-3871d8d9.js";import{N as le}from"./Switch-5cbaa6a9.js";import{N as ie}from"./Popconfirm-7d90b5a9.js";import"./AppPage-64321f57.js";import"./Checkbox-23248bff.js";import"./RadioGroup-373382a0.js";import"./get-slot-1efb97e5.js";import"./Forward-fc22679e.js";import"./Add-8e2e4207.js";import"./utils-faaa8f65.js";function se(N,h){const u=document.createElement("a");u.download=h,u.style.display="none";const y=new Blob([N]);u.href=URL.createObjectURL(y),document.body.appendChild(u),u.click(),document.body.removeChild(u)}const ne=x("span",{class:"i-material-symbols:add mr-5 text-18"},null,-1),re=x("span",{class:"i-material-symbols:recycling-rounded mr-5 text-18"},null,-1),oe=x("span",{class:"i-mdi:export mr-5 text-18"},null,-1),de={class:"inline-block"},ue=x("span",{class:"i-mdi:import mr-5 text-18"},null,-1),Be=Object.assign({name:"文章列表"},{__name:"index",setup(N){const h=j(),u=P(),y=E(),g=_([]),$=_([]),r=_(null),o=_({}),i=_({}),{handleDelete:f}=X({name:"文章",doDelete:D,refresh:()=>{var e;return(e=r.value)==null?void 0:e.handleSearch()}});F(()=>{m.getCategoryOption().then(e=>g.value=e.data),m.getTagOption().then(e=>$.value=e.data),z("all")}),J(()=>{var t;const{needRefresh:e}=h.query;e&&((t=r.value)==null||t.handleSearch())});const O=[{type:"selection",width:20,fixed:"left"},{title:"文章封面",key:"img",width:55,align:"center",render(e){return p(ae,{imgProps:{style:{"border-radius":"2px",height:"100%",width:"100%"}},src:W(e.img),fallbackSrc:"http://dummyimage.com/400x400",showToolbarTooltip:!0})}},{title:"文章标题",key:"title",width:120,align:"center",ellipsis:{tooltip:!0}},{title:"分类",key:"category.name",width:60,align:"center",ellipsis:{tooltip:!0},render(e){return p("div",e.category.name||"无")}},{title:"标签",key:"tags",width:100,align:"center",render(e){var a;const t=(a=e.tags)!=null?a:[],l=[];for(let v=0;v<t.length;v++)l.push(p(A,{type:"info",style:{margin:"2px 3px"}},{default:()=>t[v].name}));return p("div",l.length?l:"无")}},{title:"浏览量",key:"view_count",width:40,align:"center",ellipsis:{tooltip:!0}},{title:"点赞量",key:"like_count",width:40,align:"center",ellipsis:{tooltip:!0}},{title:"类型",key:"type",width:50,align:"center",render(e){return p(A,{type:B[e.type].tag},{default:()=>B[e.type].name})}},{title:"发布时间",key:"updateDate",align:"center",width:80,render(e){return p(c,{size:"small",type:"text",ghost:!0},{default:()=>G(e.updated_at),icon:U("mdi:update",{size:18})})}},{title:"置顶",key:"is_top",width:50,align:"center",fixed:"left",render(e){return p(le,{size:"small",rubberBand:!1,value:e.is_top,loading:!!e.publishing,checkedValue:1,uncheckedValue:0,onUpdateValue:()=>q(e)})}},{title:"操作",key:"actions",width:120,align:"center",fixed:"right",render(e){return[e.is_delete?p(c,{size:"small",type:"success",secondary:!0,onClick:()=>S(this,null,function*(){var t;yield m.softDeleteArticle({ids:[e.id],is_delete:0}),yield(t=r.value)==null?void 0:t.handleSearch()})},{default:()=>"恢复",icon:U("majesticons:eye-line",{size:16})}):p(c,{size:"small",type:"primary",secondary:!0,onClick:()=>u.push(`/article/write/${e.id}`)},{default:()=>"查看",icon:U("majesticons:eye-line",{size:16})}),p(ie,{onPositiveClick:()=>f([e.id],!1)},{trigger:()=>p(c,{size:"small",type:"error",style:"margin-left: 15px;"},{default:()=>"删除",icon:U("material-symbols:delete-outline",{size:16})}),default:()=>p("div",{},"确定删除该文章吗?")})]}}];function D(e){i.value.is_delete===0?m.softDeleteArticle({ids:JSON.parse(e),is_delete:1}):m.deleteArticle(e)}function q(e){return S(this,null,function*(){var t;e.id&&(e.publishing=!0,e.is_top=e.is_top===0?1:0,yield m.updateArticleTop(e),e.publishing=!1,$message==null||$message.success(e.is_top?"已成功置顶":"已取消置顶"),(t=r.value)==null||t.handleSearch())})}function I(e){return S(this,null,function*(){var l;const t=(l=r.value)==null?void 0:l.tableData.filter(a=>e.includes(a.id));for(const a of t)se(a.content,`${a.title}.md`)})}function z(e){var t;switch(e){case"all":i.value.is_delete=0,i.value.status=null;break;case"public":i.value.is_delete=0,i.value.status=1;break;case"secret":i.value.is_delete=0,i.value.status=2;break;case"draft":i.value.is_delete=0,i.value.status=3;break;case"delete":i.value.is_delete=1,i.value.status=null;break}(t=r.value)==null||t.handleSearch()}function R(e){return e.file.name.endsWith(".md")?!0:($message.error("只能上传 .md 格式的文件，请重新上传"),!1)}function V({event:e}){var a;const t=(e==null?void 0:e.target).response;JSON.parse(t).code===0?((a=r.value)==null||a.handleSearch(),$message.success("文章导入成功！")):$message.error("文章导入失败！")}return(e,t)=>(K(),L(H,{"show-footer":"",title:"文章列表"},{action:d(()=>{var l,a;return[s(n(c),{type:"primary",onClick:t[0]||(t[0]=v=>e.$router.replace("/article/write"))},{default:d(()=>[ne,k(" 新建文章 ")]),_:1}),s(n(c),{type:"error",disabled:!((l=r.value)!=null&&l.selections.length),onClick:t[1]||(t[1]=v=>{var b;return n(f)((b=r.value)==null?void 0:b.selections)})},{default:d(()=>[re,k(" 批量删除 ")]),_:1},8,["disabled"]),s(n(c),{type:"info",disabled:!((a=r.value)!=null&&a.selections.length),onClick:t[2]||(t[2]=v=>{var b;return I((b=r.value)==null?void 0:b.selections)})},{default:d(()=>[oe,k(" 批量导出 ")]),_:1},8,["disabled"]),x("div",de,[s(n(Z),{action:"/api/article/import",headers:{Authorization:`Bearer ${n(y)}`},"show-file-list":!1,multiple:"",onBeforeUpload:R,onFinish:V},{default:d(()=>[s(n(c),{type:"success"},{default:d(()=>[ue,k(" 批量导入 ")]),_:1})]),_:1},8,["headers"])])]}),default:d(()=>[s(n(ee),{type:"line",animated:"","onUpdate:value":z},{prefix:d(()=>[k(" 状态 ")]),default:d(()=>[s(n(w),{name:"all",tab:"全部"}),s(n(w),{name:"public",tab:"公开"}),s(n(w),{name:"secret",tab:"私密"}),s(n(w),{name:"draft",tab:"草稿箱"}),s(n(w),{name:"delete",tab:"回收站"})]),_:1}),s(Q,{ref_key:"$table",ref:r,"query-items":o.value,"onUpdate:queryItems":t[11]||(t[11]=l=>o.value=l),"extra-params":i.value,columns:O,"get-data":n(m).getArticles},{queryBar:d(()=>[s(C,{label:"标题","label-width":40,"content-width":180},{default:d(()=>[s(n(te),{value:o.value.title,"onUpdate:value":t[3]||(t[3]=l=>o.value.title=l),clearable:"",type:"text",placeholder:"请输入标题",onKeydown:t[4]||(t[4]=M(l=>{var a;return(a=r.value)==null?void 0:a.handleSearch()},["enter"]))},null,8,["value"])]),_:1}),s(C,{label:"类型","label-width":40,"content-width":160},{default:d(()=>[s(n(T),{value:o.value.type,"onUpdate:value":[t[5]||(t[5]=l=>o.value.type=l),t[6]||(t[6]=l=>{var a;return(a=r.value)==null?void 0:a.handleSearch()})],clearable:"",placeholder:"请选择文章类型",options:n(Y)},null,8,["value","options"])]),_:1}),s(C,{label:"分类","label-width":40,"content-width":160},{default:d(()=>[s(n(T),{value:o.value.category_id,"onUpdate:value":[t[7]||(t[7]=l=>o.value.category_id=l),t[8]||(t[8]=l=>{var a;return(a=r.value)==null?void 0:a.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择文章分类",options:g.value},null,8,["value","options"])]),_:1}),s(C,{label:"标签","label-width":40,"content-width":160},{default:d(()=>[s(n(T),{value:o.value.tag_id,"onUpdate:value":[t[9]||(t[9]=l=>o.value.tag_id=l),t[10]||(t[10]=l=>{var a;return(a=r.value)==null?void 0:a.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择文章标签",options:$.value},null,8,["value","options"])]),_:1})]),_:1},8,["query-items","extra-params","get-data"])]),_:1}))}});export{Be as default};
