import{b as n,c as o,f as e,d as U,bb as G,C as J,r as b,I as O,l as M,h as y,u as p,s as H,e as E,cY as ne,j as w,K as S,d1 as oe,_ as W,v as T,i as c,F as z,z as N,o as se,be as ae,w as ue,y as I,x as P,A as ie,q as le,n as ce,d2 as re}from"./index.6f29a4b3.js";import{_ as _e}from"./Spin.e91a07b4.js";import{f as Q}from"./date.fcf447cb.js";import{_ as de}from"./Image.069e930e.js";const pe={class:"inline-block",viewBox:"0 0 20 20",width:"1em",height:"1em"},me=e("path",{fill:"currentColor",d:"M19.295 12a.704.704 0 0 1 .705.709v3.204a.704.704 0 0 1-.7.709a.704.704 0 0 1-.7-.709v-1.125C16.779 17.844 13.399 20 9.757 20c-4.41 0-8.106-2.721-9.709-6.915a.712.712 0 0 1 .4-.917c.36-.141.766.04.906.405c1.4 3.662 4.588 6.01 8.403 6.01c3.371 0 6.52-2.182 7.987-5.154l-1.471.01a.704.704 0 0 1-.705-.704a.705.705 0 0 1 .695-.714L19.295 12Zm-9.05-12c4.408 0 8.105 2.721 9.708 6.915a.712.712 0 0 1-.4.917a.697.697 0 0 1-.906-.405c-1.4-3.662-4.588-6.01-8.403-6.01c-3.371 0-6.52 2.182-7.987 5.154l1.471-.01a.704.704 0 0 1 .705.704a.705.705 0 0 1-.695.714L.705 8A.704.704 0 0 1 0 7.291V4.087c0-.392.313-.709.7-.709c.386 0 .7.317.7.709v1.125C3.221 2.156 6.601 0 10.243 0Z"},null,-1),fe=[me];function he(_,f){return n(),o("svg",pe,fe)}const ve={name:"uiw-reload",render:he},ge={class:"inline-block",viewBox:"0 0 1792 1408",width:"1em",height:"1em"},ke=e("path",{fill:"currentColor",d:"M1408 512q0 139-94 257t-256.5 186.5T704 1024q-86 0-176-16q-124 88-278 128q-36 9-86 16h-3q-11 0-20.5-8t-11.5-21q-1-3-1-6.5t.5-6.5t2-6l2.5-5l3.5-5.5l4-5l4.5-5l4-4.5q5-6 23-25t26-29.5t22.5-29t25-38.5t20.5-44Q142 841 71 736T0 512q0-139 94-257T350.5 68.5T704 0t353.5 68.5T1314 255t94 257zm384 256q0 120-71 224.5T1526 1169q10 24 20.5 44t25 38.5t22.5 29t26 29.5t23 25q1 1 4 4.5t4.5 5t4 5t3.5 5.5l2.5 5l2 6l.5 6.5l-1 6.5q-3 14-13 22t-22 7q-50-7-86-16q-154-40-278-128q-90 16-176 16q-271 0-472-132q58 4 88 4q161 0 309-45t264-129q125-92 192-212t67-254q0-77-23-152q129 71 204 178t75 230z"},null,-1),ye=[ke];function be(_,f){return n(),o("svg",ge,ye)}const Ce={name:"fa-comments",render:be},we={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},xe=e("path",{fill:"currentColor",d:"M20 12a8 8 0 0 0-8-8a8 8 0 0 0-8 8a8 8 0 0 0 8 8a8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12A10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5S7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5S14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"},null,-1),$e=[xe];function Be(_,f){return n(),o("svg",we,$e)}const De={name:"mdi-emoticon-happy-outline",render:Be},Fe={key:0,flex:"","p-10":"","mt-15":"","border-1px":"","border-solid":"","border-rounded-1rem":"","border-color":"#90939950"},Ae={"w-full":"","my-5":"","ml-12":""},Ee=["placeholder"],qe={flex:"","justify-between":""},Se=U({__name:"CommentField",props:{type:{},show:{type:Boolean},topicId:{}},emits:["afterSubmit"],setup(_,{expose:f,emit:B}){var $;const h=_,[s,v]=[G(),J()];let g=b(h.show);const i=O({nickname:"",content:"",topic_id:($=h.topicId)!=null?$:0,reply_user_id:0,parent_id:0,type:h.type}),D=M(()=>!!i.nickname);function x(m){g.value=m}async function l(){var m,C;if(!s.userId){v.setLoginFlag(!0);return}if(!i.content.trim()){(m=window.$message)==null||m.error("\u8BC4\u8BBA\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A");return}try{await S.saveComment(i),(C=window.$message)==null||C.info("\u8BC4\u8BBA\u6210\u529F"),i.content="",D.value&&x(!1),B("afterSubmit")}catch(R){console.error(R)}}function q(){var m;(m=window.$message)==null||m.info("\u8868\u60C5\u9009\u62E9\u6B63\u5728\u5F00\u53D1\u4E2D...")}const k=M(()=>i.nickname?`\u56DE\u590D @${i.nickname}\uFF1A`:"\u7559\u4E0B\u70B9\u4EC0\u4E48\u5427...");return f({data:i,setReply:x}),(m,C)=>{const R=oe,V=De;return g.value?(n(),o("div",Fe,[y(R,{round:"",size:36,src:p(H)(p(s).avatar)},null,8,["src"]),e("div",Ae,[E(e("textarea",{"onUpdate:modelValue":C[0]||(C[0]=L=>p(i).content=L),placeholder:p(k),rows:"5","text-16":"","w-full":"","bg-light-400":""},null,8,Ee),[[ne,p(i).content]]),e("div",qe,[y(V,{"text-24":"","text-orange":"","cursor-pointer":"",onClick:q}),e("div",null,[p(i).nickname?(n(),o("span",{key:0,btn:"","bg-bluegray":"","hover:bg-bluegray":"","mr-15":"",onClick:C[1]||(C[1]=L=>x(!1))}," \u53D6\u6D88 ")):w("",!0),e("span",{btn:"",onClick:l}," \u63D0\u4EA4 ")])])])])):w("",!0)}}});const Y=W(Se,[["__scopeId","data-v-d5beec5a"]]),Te={"mt-15":"","mb-10":"","text-12":""},Re={"mr-10":""},Le=["onClick"],Ie={key:0,color:"#00a1d6","font-bold":""},ze={key:1},Me=U({__name:"Paging",props:{pageTotal:{default:0},index:{},commentId:{}},emits:["changeCurrent"],setup(_,{expose:f,emit:B}){let h=b(!1),s=b(1);const v=M(()=>l=>l===s.value);function g(){s.value-=1,B("changeCurrent",s.value,_.index,_.commentId)}function i(){s.value+=1,B("changeCurrent",s.value,_.index,_.commentId)}function D(l){s.value=l,B("changeCurrent",s.value,_.index,_.commentId)}function x(l){h.value=l}return f({current:s.value,setShow:x}),(l,q)=>E((n(),o("div",Te,[e("span",Re," \u5171 "+c(l.pageTotal)+" \u9875 ",1),E(e("a",{onClick:g}," \u4E0A\u4E00\u9875 ",512),[[T,s.value!==1]]),l.pageTotal<6?(n(!0),o(z,{key:0},N(l.pageTotal,k=>(n(),o("a",{key:k,"mx-5":"",onClick:$=>D(k)},[p(v)(k)?(n(),o("span",Ie,c(k),1)):(n(),o("span",ze,c(k),1))],8,Le))),128)):w("",!0),E(e("a",{onClick:i}," \u4E0B\u4E00\u9875 ",512),[[T,s.value!==l.pageTotal]])],512)),[[T,h.value]])}});const Ve=W(Me,[["__scopeId","data-v-30e2f6fc"]]),Pe={"text-20":"","font-bold":"",flex:"","items-center":""},He={key:0},Ne={"mt-30":"","mb-15":"","text-20":"","font-bold":"",flex:"","items-center":""},Ue={"flex-col":"","flex-1":"","ml-10":""},Ze={key:0,"text-14":""},je=["href"],Ke={key:2,bg:"#ffa51e",color:"#fff","px-6":"","py-1":"","ml-6":"","rounded-3":"","text-12":"","inline-block":""},Qe={flex:"","justify-between":"","text-12":""},Ye={color:"#b3b3b3","py-5":"",flex:"","items-center":""},Ge={"mx-10":""},Je=["onClick"],Oe=["onClick"],We=["innerHTML"],Xe={"flex-col":"","flex-1":"","ml-10":""},et={key:0,"text-14":""},tt=["href"],nt={key:2,bg:"#ffa51e",color:"#fff","px-6":"","py-1":"","ml-6":"","rounded-3":"","text-12":"","inline-block":""},ot={flex:"","justify-between":"","text-12":""},st={color:"#b3b3b3","py-5":"",flex:"","items-center":""},at={"mr-10":""},ut=["onClick"],it=["onClick"],lt={key:0},ct=["href"],rt=["innerHTML"],_t=["onClick"],dt={key:0,"h-1":"","bg-light-500":"","my-10":""},pt={"f-c-c":"","m-15":""},mt={key:1,"animate-bounce":""},ft={key:1,"text-center":"","mt-30":"","mb-10":"","text-zinc":"","text-16":""},yt=U({__name:"Comment",props:{type:{}},setup(_){var j;const[f,B]=[G(),J()];se(()=>{D()});const h=+((j=ae().params.id)!=null?j:0);let s=b([]),v=b(0),g=b(!1);const i=O({type:_.type,page_size:10,page_num:1,topic_id:h});async function D(){g.value=!0;try{const t=await S.getComments(i);setTimeout(()=>{i.page_num===1?s.value=t.data.pageData:s.value.push(...t.data.pageData),v.value=t.data.total,i.page_num++,g.value=!1},800)}catch(t){console.error(t)}}function x(){i.page_num=1,D()}let l=b(!0);ue(s,()=>{l.value=!1,ce(()=>{l.value=!0})},{deep:!1});const q=b([]);function k(t,r){q.value.forEach(F=>F.setReply(!1));const d=q.value[t];d.setReply(!0),d.data.nickname=r.nickname,d.data.reply_user_id=r.user_id,d.data.parent_id=s.value[t].id}const $=b([]),m=b([]);async function C(t){const{data:r}=await S.getCommentReplies(s.value[t].id,{page_size:5,page_num:$.value[t].current});s.value[t].reply_vo_list=r,s.value[t].reply_count++,s.value[t].reply_count>5&&$.value[t].setShow(!0),m.value[t].style.display="none"}async function R(t,r){const{data:d}=await S.getCommentReplies(r.id,{page_num:1,page_size:5});r.reply_vo_list=d,r.reply_count>5&&$.value[t].setShow(!0),m.value[t].style.display="none"}async function V(t,r,d){const{data:F}=await S.getCommentReplies(d,{page_num:t,page_size:5});s.value[r].reply_vo_list=F}async function L(t){var r,d;if(!f.userId){B.setLoginFlag(!0);return}try{await S.saveLikeComment(t.id),f.commentLikeSet.includes(t.id)?(t.like_count--,(r=window.$message)==null||r.info("\u5DF2\u53D6\u6D88")):(t.like_count++,(d=window.$message)==null||d.success("\u5DF2\u70B9\u8D5E")),f.commentLike(t.id)}catch(F){console.error(F)}}const Z=M(()=>t=>f.commentLikeSet.includes(t));return(t,r)=>{const d=Ce,F=ve,K=de,X=re,ee=_e;return n(),o("div",null,[e("p",Pe,[y(d,{"mr-5":"","text-24":"","text-blue":""}),I(" \u8BC4\u8BBA ")]),y(Y,{show:!0,type:t.type,"topic-id":h,onAfterSubmit:x},null,8,["type"]),v.value>0&&l.value?(n(),o("div",He,[e("p",Ne,[e("span",null,c(v.value)+" \u8BC4\u8BBA ",1),y(F,{"ml-15":"","cursor-pointer":"","text-18":"",class:P(g.value?"animate-spin":""),onClick:x},null,8,["class"])]),(n(!0),o(z,null,N(s.value,(u,A)=>(n(),o("div",{key:u.id,"my-5":"",flex:""},[e("div",null,[y(K,{src:p(H)(u.avatar),width:"40","duration-600":"","hover-rotate-360":""},null,8,["src"])]),e("div",Ue,[e("p",null,[u.website?(n(),o("a",{key:1,href:u.website,target:"_blank",color:"#1abc9c","font-500":"","transition-300":""},c(u.nickname),9,je)):(n(),o("span",Ze,c(u.nickname),1)),u.user_id===10?(n(),o("span",Ke," \u535A\u4E3B ")):w("",!0)]),e("div",Qe,[e("div",Ye,[e("span",null,c(v.value-A)+"\u697C ",1),e("span",Ge,c(p(Q)(u.created_at)),1),e("button",{"i-mdi:thumb-up":"",class:P(p(Z)(u.id)?"bg-red":""),"hover-bg-red":"",onClick:a=>L(u)},null,10,Je),E(e("span",null,c(u.like_count),513),[[T,u.like_count]])]),e("button",{color:"#ef2f11",onClick:a=>k(A,u)}," \u56DE\u590D ",8,Oe)]),e("div",{"my-3":"",innerHTML:u.content},null,8,We),(n(!0),o(z,null,N(u.reply_vo_list,a=>(n(),o("div",{key:a.id,"mt-10":"",flex:""},[e("div",null,[y(K,{src:p(H)(a.avatar),width:"40","duration-600":"","hover-rotate-360":""},null,8,["src"])]),e("div",Xe,[e("div",null,[a.website?(n(),o("a",{key:1,href:a.website,target:"_blank",color:"#1abc9c","font-500":"","transition-300":""},c(a.nickname),9,tt)):(n(),o("span",et,c(a.nickname),1)),a.user_id===10?(n(),o("span",nt," \u535A\u4E3B ")):w("",!0)]),e("div",ot,[e("div",st,[e("span",at,c(p(Q)(a.created_at)),1),e("button",{"i-mdi:thumb-up":"",class:P(p(Z)(a.id)?"bg-red":""),"hover-bg-red":"",onClick:te=>L(a)},null,10,ut),E(e("span",null,c(a.like_count),513),[[T,a.like_count]])]),e("button",{color:"#ef2f11",onClick:te=>k(A,a)}," \u56DE\u590D ",8,it)]),e("div",null,[a.reply_user_id!==u.user_id?(n(),o(z,{key:0},[a.reply_website?(n(),o("a",{key:1,href:a.reply_website,target:"_blank"}," @"+c(a.reply_nickname),9,ct)):(n(),o("span",lt," @"+c(a.reply_nickname),1)),I(" \uFF0C ")],64)):w("",!0),e("span",{"my-3":"",innerHTML:a.content},null,8,rt)])])]))),128)),E(e("div",{ref_for:!0,ref_key:"checkRefs",ref:m,"mt-15":"",color:"#6d757a","text-13":""},[I(" \u5171 "),e("b",null,c(u.reply_count),1),I(" \u6761\u56DE\u590D "),e("button",{color:"#00a1d6",onClick:a=>R(A,u)}," \uFF0C\u70B9\u51FB\u67E5\u770B ",8,_t)],512),[[T,u.reply_count>3]]),y(Ve,{ref_for:!0,ref_key:"pageRefs",ref:$,"page-total":Math.ceil(u.reply_count/5),index:A,"comment-id":u.id,onChangeCurrent:V},null,8,["page-total","index","comment-id"]),y(Y,{ref_for:!0,ref_key:"replyFieldRefs",ref:q,show:!1,type:t.type,"topic-id":h,onAfterSubmit:a=>C(A)},null,8,["type","onAfterSubmit"]),A+1!==v.value?(n(),o("div",dt)):w("",!0)])]))),128)),e("div",pt,[v.value>s.value.length&&!g.value?(n(),ie(X,{key:0,text:"",onClick:D},{default:le(()=>[I(" \u70B9\u51FB\u52A0\u8F7D\u66F4\u591A... ")]),_:1})):w("",!0),g.value?(n(),o("div",mt,[y(ee,{size:"small"})])):w("",!0)])])):(n(),o("div",ft," \u6682\u65E0\u8BC4\u8BBA\uFF0C\u6765\u53D1\u8BC4\u8BBA\u5427~ "))])}}});export{yt as _};
