var U=(x,d,r)=>new Promise((c,g)=>{var b=o=>{try{f(r.next(o))}catch(p){g(p)}},u=o=>{try{f(r.throw(o))}catch(p){g(p)}},f=o=>o.done?c(o.value):Promise.resolve(o.value).then(b,u);f((r=r.apply(x,d)).next())});import{r as y,k as _,p as R,o as v,c as S,w as n,a as i,u as l,j as V,Z as D,ab as O,aa as K,q as T,v as s,B as j,C as w,x as I,y as k,N}from"./index-f53dfd2d.js";import{_ as E}from"./CommonPage-328ed173.js";import{_ as z}from"./QueryBarItem-a7adc33b.js";import{_ as L}from"./CrudModal-8441a1a6.js";import{_ as M}from"./CrudTable-e7ebf5b4.js";import{u as P}from"./useCRUD-6648f9c7.js";import{l as G,e as B}from"./data-b2a19723.js";import{a as Z,N as A}from"./Checkbox-23248bff.js";import{N as $}from"./Input-d1b207b8.js";import{N as H,b as J}from"./Space-fc8792cb.js";import{N as Q,a as q}from"./FormItem-9890d329.js";import{N as W}from"./Image-3871d8d9.js";import{N as X}from"./Switch-5cbaa6a9.js";import"./AppPage-64321f57.js";import"./RadioGroup-373382a0.js";import"./get-slot-1efb97e5.js";import"./Forward-fc22679e.js";import"./utils-faaa8f65.js";const he=Object.assign({name:"用户列表"},{__name:"index",setup(x){const d=y(null),r=y({}),{modalVisible:c,modalLoading:g,handleSave:b,modalForm:u,modalFormRef:f,handleEdit:o}=P({name:"用户",doUpdate:_.updateUser,refresh:()=>{var e;return(e=d.value)==null?void 0:e.handleSearch()}}),p=y([]);R(()=>{var e;_.getRoleOption().then(a=>p.value=a.data),(e=d.value)==null||e.handleSearch()});const C=[{title:"头像",key:"avatar",width:50,align:"center",render(e){return s(W,{height:50,imgProps:{style:{"border-radius":"3px"}},src:j(e.avatar),"fallback-src":"http://dummyimage.com/400x400","show-toolbar-tooltip":!0})}},{title:"昵称",key:"nickname",width:60,align:"center",ellipsis:{tooltip:!0}},{title:"登录方式",key:"login_type",width:40,align:"center",render(e){return s(w,{type:B[e.login_type].tag},{default:()=>B[e.login_type].name})}},{title:"用户角色",key:"role",width:80,align:"center",render(e){var m;const a=(m=e.roles)!=null?m:[],t=[];for(let h=0;h<a.length;h++)t.push(s(w,{type:"info",style:{margin:"2px 3px"}},{default:()=>a[h].name}));return s("span",t)}},{title:"登录 IP",key:"ip_address",width:70,align:"center",ellipsis:{tooltip:!0},render(e){return s("span",e.ip_address||"未知")}},{title:"登录地址",key:"ip_source",width:70,align:"center",ellipsis:{tooltip:!0},render(e){return s("span",e.ip_source||"未知")}},{title:"创建时间",key:"created_at",align:"center",width:70,render(e){return s(N,{size:"small",type:"text",ghost:!0},{default:()=>I(e.created_at),icon:k("mdi:update",{size:18})})}},{title:"上次登录时间",key:"last_login_time",align:"center",width:70,render(e){return s(N,{size:"small",type:"text",ghost:!0},{default:()=>I(e.last_login_time),icon:k("mdi:update",{size:18})})}},{title:"禁用",key:"is_disable",width:30,align:"center",fixed:"left",render(e){return s(X,{size:"small",rubberBand:!1,value:e.is_disable,loading:!!e.publishing,checkedValue:1,uncheckedValue:0,onUpdateValue:()=>F(e)})}},{title:"操作",key:"actions",width:60,align:"center",fixed:"right",render(e){return[s(N,{size:"small",type:"primary",onClick:()=>{e.role_ids=e.roles.map(a=>a.id),o(e)}},{default:()=>"编辑",icon:k("material-symbols:delete-outline",{size:16})})]}}];function F(e){return U(this,null,function*(){var a;if(e.id){e.publishing=!0,e.is_disable=e.is_disable===0?1:0;try{yield _.updateUserDisable(e),$message==null||$message.success(e.is_disable?"已禁用该用户":"已取消禁用该用户"),(a=d.value)==null||a.handleSearch()}catch(t){e.is_disable=e.is_disable===0?1:0}finally{e.publishing=!1}}})}return(e,a)=>(v(),S(E,{"show-footer":"",title:"用户列表"},{default:n(()=>[i(M,{ref_key:"$table",ref:d,"query-items":r.value,"onUpdate:queryItems":a[2]||(a[2]=t=>r.value=t),columns:C,"get-data":l(_).getUsers},{queryBar:n(()=>[i(z,{label:"昵称","label-width":40},{default:n(()=>{var t;return[i(l($),{value:r.value.nickname,"onUpdate:value":a[0]||(a[0]=m=>r.value.nickname=m),clearable:"",type:"text",placeholder:"请输入用户昵称",onKeydown:V((t=d.value)==null?void 0:t.handleSearch,["enter"])},null,8,["value","onKeydown"])]}),_:1}),i(z,{label:"登录方式","label-width":70,"content-width":180},{default:n(()=>{var t;return[i(l(H),{value:r.value.login_type,"onUpdate:value":[a[1]||(a[1]=m=>r.value.login_type=m),(t=d.value)==null?void 0:t.handleSearch],clearable:"",filterable:"",placeholder:"请选择登录方式",options:l(G)},null,8,["value","options","onUpdate:value"])]}),_:1})]),_:1},8,["query-items","get-data"]),i(L,{visible:l(c),"onUpdate:visible":a[5]||(a[5]=t=>T(c)?c.value=t:null),title:"修改用户",loading:l(g),onSave:l(b)},{default:n(()=>[i(l(Q),{ref_key:"modalFormRef",ref:f,"label-placement":"left","label-align":"left","label-width":80,model:l(u)},{default:n(()=>[i(l(q),{label:"用户昵称",path:"name"},{default:n(()=>[i(l($),{value:l(u).nickname,"onUpdate:value":a[3]||(a[3]=t=>l(u).nickname=t),clearable:"",placeholder:"请输入用户昵称"},null,8,["value"])]),_:1}),i(l(q),{label:"角色",path:"role_ids"},{default:n(()=>[i(l(Z),{value:l(u).role_ids,"onUpdate:value":a[4]||(a[4]=t=>l(u).role_ids=t)},{default:n(()=>[i(l(J),{"item-style":"display: flex;"},{default:n(()=>[(v(!0),D(K,null,O(p.value,t=>(v(),S(l(A),{key:t.value,value:t.value,label:t.label},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","loading","onSave"])]),_:1}))}});export{he as default};
