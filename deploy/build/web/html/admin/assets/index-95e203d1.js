var x=(w,l,r)=>new Promise((d,c)=>{var y=e=>{try{u(r.next(e))}catch(t){c(t)}},f=e=>{try{u(r.throw(e))}catch(t){c(t)}},u=e=>e.done?d(e.value):Promise.resolve(e.value).then(y,f);u((r=r.apply(w,l)).next())});import{p as U,r as h,k as g,o as B,c as I,w as o,a as i,b as _,u as n,N as p,j as S,d as z,v as s,B as q,x as P,y as v,C as N}from"./index-f53dfd2d.js";import{_ as D}from"./CommonPage-328ed173.js";import{_ as C}from"./QueryBarItem-a7adc33b.js";import{_ as R}from"./CrudTable-e7ebf5b4.js";import{u as V}from"./useCRUD-6648f9c7.js";import{c as j,d as $}from"./data-b2a19723.js";import{N as b,a as K}from"./Tabs-435e8678.js";import{N as M}from"./Input-d1b207b8.js";import{N as O}from"./Space-fc8792cb.js";import{N as A}from"./Image-3871d8d9.js";import{N as E}from"./Popconfirm-7d90b5a9.js";import"./AppPage-64321f57.js";import"./Checkbox-23248bff.js";import"./RadioGroup-373382a0.js";import"./get-slot-1efb97e5.js";import"./Forward-fc22679e.js";import"./Add-8e2e4207.js";import"./utils-faaa8f65.js";const F=z("span",{class:"i-material-symbols:recycling-rounded mr-5 text-18"},null,-1),G=z("span",{class:"i-ic:outline-approval mr-5 text-18"},null,-1),ue=Object.assign({name:"评论管理"},{__name:"index",setup(w){U(()=>{u("all")});const l=h(null),r=h({}),d=h({}),{handleDelete:c}=V({name:"评论",doDelete:g.deleteComments,refresh:()=>{var e;return(e=l.value)==null?void 0:e.handleSearch()}}),y=[{type:"selection",width:15,fixed:"left"},{title:"头像",key:"avatar",width:50,align:"center",render(e){return s(A,{height:50,imgProps:{style:{"border-radius":"3px"}},src:q(e.avatar),"fallback-src":"http://dummyimage.com/400x400","show-toolbar-tooltip":!0})}},{title:"评论人",key:"nickname",width:50,align:"center",ellipsis:{tooltip:!0}},{title:"回复对象",key:"reply_nick_name",width:50,align:"center",render(e){return s("span",e.reply_nickname||"无")}},{title:"评论内容",key:"content",width:140,align:"center",ellipsis:{tooltip:!0}},{title:"评论时间",key:"created_at",align:"center",width:60,render(e){return s(p,{size:"small",type:"text",ghost:!0},{default:()=>P(e.created_at),icon:v("mdi:update",{size:18})})}},{title:"状态",key:"is_review",width:50,align:"center",render(e){return s(N,{type:e.is_review?"success":"error"},{default:()=>e.is_review?"通过":"审核中"})}},{title:"来源",key:"type",width:50,align:"center",render(e){return s(N,{type:$[e.type].tag},{default:()=>$[e.type].name})}},{title:"操作",key:"actions",width:100,align:"center",fixed:"right",render(e){return[e.is_review?s(p,{size:"small",type:"warning",style:"margin-left: 15px;",onClick:()=>f([e.id],0)},{default:()=>"撤下",icon:v("mi:circle-error",{size:16})}):s(p,{size:"small",type:"success",style:"margin-left: 15px;",onClick:()=>f([e.id],1)},{default:()=>"通过",icon:v("mi:circle-check",{size:16})}),s(E,{onPositiveClick:()=>c([e.id],!1)},{trigger:()=>s(p,{size:"small",type:"error",style:"margin-left: 15px;"},{default:()=>"删除",icon:v("material-symbols:delete-outline",{size:16})}),default:()=>s("div",{},"确定删除该条评论吗?")})]}}];function f(e,t){return x(this,null,function*(){var a;if(!e.length){$message.info("请选择要审核的数据");return}yield g.updateCommentReview({ids:e,is_review:t}),$message==null||$message.success(t?"审核成功":"撤下成功"),(a=l.value)==null||a.handleSearch()})}function u(e){var t;switch(e){case"all":d.value.is_review=null;break;case"has_review":d.value.is_review=1;break;case"not_review":d.value.is_review=0;break}(t=l.value)==null||t.handleSearch()}return(e,t)=>(B(),I(D,{"show-footer":"",title:"评论管理"},{action:o(()=>{var a,m;return[i(n(p),{type:"error",disabled:!((a=l.value)!=null&&a.selections.length),onClick:t[0]||(t[0]=T=>{var k;return n(c)((k=l.value)==null?void 0:k.selections)})},{default:o(()=>[F,_(" 批量删除 ")]),_:1},8,["disabled"]),i(n(p),{type:"success",disabled:!((m=l.value)!=null&&m.selections.length),onClick:t[1]||(t[1]=T=>f(l.value.selections,1))},{default:o(()=>[G,_(" 批量通过 ")]),_:1},8,["disabled"])]}),default:o(()=>[i(n(K),{type:"line",animated:"","onUpdate:value":u},{prefix:o(()=>[_(" 状态 ")]),default:o(()=>[i(n(b),{name:"all",tab:"全部"}),i(n(b),{name:"has_review",tab:"通过"}),i(n(b),{name:"not_review",tab:"审核中"})]),_:1}),i(R,{ref_key:"$table",ref:l,"query-items":r.value,"onUpdate:queryItems":t[6]||(t[6]=a=>r.value=a),"extra-params":d.value,columns:y,"get-data":n(g).getComments},{queryBar:o(()=>[i(C,{label:"用户","label-width":40,"content-width":180},{default:o(()=>[i(n(M),{value:r.value.nickname,"onUpdate:value":t[2]||(t[2]=a=>r.value.nickname=a),clearable:"",type:"text",placeholder:"请输入用户昵称",onKeydown:t[3]||(t[3]=S(a=>{var m;return(m=l.value)==null?void 0:m.handleSearch()},["enter"]))},null,8,["value"])]),_:1}),i(C,{label:"来源","label-width":40,"content-width":160},{default:o(()=>[i(n(O),{value:r.value.type,"onUpdate:value":[t[4]||(t[4]=a=>r.value.type=a),t[5]||(t[5]=a=>{var m;return(m=l.value)==null?void 0:m.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择评论来源",options:n(j)},null,8,["value","options"])]),_:1})]),_:1},8,["query-items","extra-params","get-data"])]),_:1}))}});export{ue as default};
